# 基于栈的中缀表达式转后缀表达式和求值

## 前言

后缀表达式（将运算符写在操作数之后）又叫做逆波兰表达式。逆波兰表示法是波兰逻辑学家J・卢卡西维兹(J・ Lukasiewicz)
于1929年首先提出的一种表达式的表示方法。后来,人们就把用这种表示法写出的表达式称作“逆波兰表达式”。逆波兰表达式把运算量写在前面,把算符写在后面。

逆波兰表达式是一种十分有用的表达式，它将复杂表达式转换为可以依靠简单的操作得到计算结果的表达式。例如 `(a+b)*(c+d)` 转换为 `ab+cd+*`。

它的优势在于只用两种简单操作，入栈和出栈就可以搞定任何普通表达式的运算。

## 算法

### 转换

首先我们要从左到右扫描中缀表达式字符串，然后根据每个字符分别做出不同的操作

- `操作数`

  操作数即我们的数字，可以使用 `isdigit` 函数来进行判断，若是数字直接添加到后缀字符串末尾。

  > 若要支持多位(>9)的数字，需要在数和数中间加入分割符来区分两个数，这里使用空格 ` ` 来进行处理。
  >
  > 如要支持小数，则需要加入对字符 `.` 的判定，将字符 `.` 一并添加到后缀字符串末尾。

>

- `括号`

  若读取到括号 `(、)` 则括号中间的部分为以整体。

    - `(`：

      当读取到左括号 `(` 时，将其添加到栈内，等到读取到右括号 `)` 时再统一处理。

    - `)`：

      当读取到右括号 `)` 时，表示这个空间结束，优先计算这个空间内的顺序，即我们需要从栈中一次弹出操作符添加到后缀字符串末尾，直到碰到与之闭合的左括号 `(` 为止。

- `操作符`

  若我们碰到的是操作符 `+-*/`，则直接压入栈中，但在压入之前我们还需要考虑操作符之间的优先级 `*/>+-`。若栈顶的高于或等于它，就要反复弹出栈顶操作符，添加到后缀字符串末尾，直到栈顶的操作符优先级低于它。

  在我们进行运算时，各个操作符的优先级为 `*/:3, +-:2,(:1`，操作符 `)` 不会入栈。

    - 当碰到 `+-` 操作符时

      只有 `(` 的优先级比 `+-` 低, 不为 `(` 则一直弹出
    - 当碰到 `*/` 操作符时

      只有 `*/` 的优先级不比 `*/` 低, 当为 `*/` 才继续弹出

### 求值

后缀表达式求值时也要从左到右扫描中缀表达式字符串，然后根据每个字符分别做出不同的操作

- `操作数`

  操作数即我们的数字，可以使用 `isdigit` 函数来进行判断，并使用 `(float) c - 48`，将其转换为浮点数(使用整数在计算除法时会产生精度损失问题)。然后将这个浮点数添加到栈中。

  > 若要支持多位(>9)的数字，需要读取连续的多个数字，即当字符为数字是开始读取，当字符不是数字时结束读取，这当中读取的N个字符就是一个多位数整体，再使用 `atoi` 将其转换成整数。
  >
  > 若要支持小数，则需要加入对字符 `.` 的判定，即当字符为数字是开始读取，当字符不是数字不是字符 `.` 时结束读取，这当中读取的N个字符就是一个多位数整体，再使用 `atoi` 将其转换成整数。

- `操作符`

  当遇到操作符 `+-*/` 时，需要在栈中取出两个操作数，再按照不同的运算规则进行运算。

  计算 `-/` 时，操作数的顺序不同会有不同的结果，`a-b!=b-a`、`a/b!=b/a`。

  入栈时操作数a先入栈, b后入栈, 故应先弹出b, 再弹出b。

  最后再将计算结果入栈以便下次计算使用。

## 代码示例

本篇提供了两套不同的代码，`simple` 和 `universal`。

- `simple`

  较为简易的实现，只支持单位数(0-9)进行计算。

  使用了存储 `char` 的栈存储

  在前缀后缀转换时使用存储 `char` 的栈来存储操作符，在求值时使用存储 `float` 的栈来存储计算用的值。

  存储 `char` 的栈和存储 `float` 使用的一套代码，基本重合。

- `universal`

  较为通用的实现，支持多位数(>9)以及小数进行计算。

  代码部分使用了可以存储任意数值(`基本类型+string`)的栈来实现。

参考文章

1. [C 语言中 void* 详解及应用)](https://www.runoob.com/w3cnote/c-void-intro.html)
2. [C语言使用 void 指针实现栈模板)](https://www.cnblogs.com/jeffo/p/stack-using-void-pointer.html)
3. [如何利用堆栈及逆波兰表达式进行数学四则运算(C语言版))](https://www.xuebuyuan.com/1602553.html)
4. [C语言实现通用数据类型栈)](https://www.2cto.com/kf/201108/98664.html)